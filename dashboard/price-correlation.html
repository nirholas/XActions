<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tweet-Price Correlation ‚Äî Do Founder Tweets Move Token Prices? | XActions</title>
  <meta name="description" content="Interactive chart showing how crypto founder tweets correlate with token price movements. TradingView-style candlesticks with tweet markers, silence gaps, and impact analysis.">
  <meta name="keywords" content="tweet price correlation, crypto founder tweets, token price impact, twitter crypto analysis, tweet price charts, founder tweet analysis">
  <meta name="author" content="nich (@nichxbt)">
  <meta name="robots" content="index, follow">

  <meta property="og:type" content="website">
  <meta property="og:title" content="Tweet-Price Correlation ‚Äî XActions">
  <meta property="og:description" content="Do founder tweets move token prices? Interactive chart with candlesticks, tweet markers, and price impact analysis.">
  <meta property="og:url" content="https://xactions.app/price-correlation">
  <meta property="og:site_name" content="XActions">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@nichxbt">
  <meta name="twitter:title" content="Tweet-Price Correlation ‚Äî XActions">

  <link rel="canonical" href="https://xactions.app/price-correlation">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚ö°</text></svg>">

  <script type="application/ld+json">
  {"@context":"https://schema.org","@type":"WebApplication","name":"XActions Tweet-Price Correlation","description":"Interactive chart showing crypto founder tweet correlation with token price movements","url":"https://xactions.app/price-correlation","applicationCategory":"AnalyticsApplication","operatingSystem":"Web Browser","offers":{"@type":"Offer","price":"0","priceCurrency":"USD"}}
  </script>

  <!-- TradingView Lightweight Charts -->
  <script src="https://unpkg.com/lightweight-charts@4.1.3/dist/lightweight-charts.standalone.production.js"></script>

  <style>
    :root {
      --bg-primary: #0a0a0f;
      --bg-secondary: #131722;
      --bg-tertiary: #1e222d;
      --bg-card: #1a1e2e;
      --bg-hover: #252a3a;
      --accent: #1d9bf0;
      --accent-hover: #1a8cd8;
      --text-primary: #d1d4dc;
      --text-secondary: #787b86;
      --text-muted: #555;
      --border: #2a2e39;
      --green: #26a69a;
      --green-bright: #22e29a;
      --red: #ef5350;
      --red-dim: #cc3c3a;
      --purple: #a855f7;
      --yellow: #ffeb3b;
      --orange: #ff9800;
      --cyan: #00bcd4;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* ===== Top Bar ===== */
    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 16px;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .topbar-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    /* Asset Selector */
    .asset-selector {
      position: relative;
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      padding: 4px 12px 4px 4px;
      border-radius: 8px;
      transition: background 0.15s;
    }
    .asset-selector:hover { background: var(--bg-tertiary); }

    .asset-color-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .asset-selector .token-name {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .asset-selector .token-badge {
      background: var(--bg-tertiary);
      color: var(--text-secondary);
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 4px;
      font-weight: 500;
      text-transform: uppercase;
    }

    .asset-selector .founder-tag {
      color: var(--text-secondary);
      font-size: 13px;
    }

    .selector-arrow {
      color: var(--text-secondary);
      font-size: 10px;
      margin-left: 4px;
      transition: transform 0.2s;
    }
    .asset-selector.open .selector-arrow { transform: rotate(180deg); }

    .asset-dropdown {
      display: none;
      position: absolute;
      top: 100%;
      left: 0;
      margin-top: 4px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 10px;
      width: 340px;
      max-height: 480px;
      overflow-y: auto;
      z-index: 200;
      box-shadow: 0 12px 40px rgba(0,0,0,0.6);
      padding: 6px;
    }
    .asset-selector.open .asset-dropdown { display: block; }

    .asset-dropdown-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.1s;
    }
    .asset-dropdown-item:hover { background: var(--bg-hover); }
    .asset-dropdown-item.active { background: var(--bg-tertiary); }

    .asset-dropdown-item .item-color {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .asset-dropdown-item .item-name {
      font-weight: 600;
      font-size: 14px;
      color: var(--text-primary);
      min-width: 70px;
    }

    .asset-dropdown-item .item-founder {
      font-size: 13px;
      color: var(--text-secondary);
      flex: 1;
    }

    .asset-dropdown-item .item-network {
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 4px;
      background: var(--bg-tertiary);
      color: var(--text-secondary);
      text-transform: uppercase;
      font-weight: 500;
    }

    .token-pair {
      color: var(--text-secondary);
      font-size: 14px;
    }

    .topbar-right {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .view-tab {
      padding: 8px 20px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      color: var(--text-secondary);
      background: transparent;
      border: none;
      transition: all 0.15s;
    }
    .view-tab:hover { color: var(--text-primary); background: var(--bg-tertiary); }
    .view-tab.active { color: #fff; background: var(--accent); }

    /* ===== Chart Sub-header ===== */
    .chart-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 6px 16px;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border);
    }

    .chart-header-left {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .chart-tab {
      padding: 6px 14px;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      color: var(--text-secondary);
      background: transparent;
      border: 1px solid transparent;
      transition: all 0.15s;
    }
    .chart-tab:hover { color: var(--text-primary); }
    .chart-tab.active { color: var(--text-primary); border-color: var(--border); background: var(--bg-tertiary); }

    .chart-header-right {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 12px;
      color: var(--text-secondary);
    }

    /* ===== Chart Container ===== */
    .chart-container {
      position: relative;
      width: 100%;
      height: calc(100vh - 140px);
      min-height: 500px;
      background: var(--bg-secondary);
    }

    #chart { width: 100%; height: 100%; }

    /* Tweet marker overlay */
    .tweet-markers-layer {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 10;
    }

    .tweet-marker {
      position: absolute;
      pointer-events: auto;
      cursor: pointer;
      transition: transform 0.15s;
    }
    .tweet-marker:hover { transform: scale(1.2); z-index: 20; }

    .marker-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: 2px solid var(--purple);
      background: var(--bg-tertiary);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      position: relative;
      overflow: hidden;
    }

    .marker-count {
      position: absolute;
      top: -6px;
      right: -6px;
      background: var(--yellow);
      color: #000;
      font-size: 9px;
      font-weight: 700;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      line-height: 1;
    }

    /* Tooltip */
    .tweet-tooltip {
      display: none;
      position: absolute;
      bottom: 42px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 10px 14px;
      width: 300px;
      z-index: 30;
      pointer-events: auto;
      box-shadow: 0 8px 32px rgba(0,0,0,0.5);
    }
    .tweet-marker:hover .tweet-tooltip { display: block; }
    .tweet-tooltip .tt-date { font-size: 11px; color: var(--text-secondary); margin-bottom: 4px; }
    .tweet-tooltip .tt-text { font-size: 13px; color: var(--text-primary); line-height: 1.4; margin-bottom: 6px; }
    .tweet-tooltip .tt-stats { font-size: 11px; color: var(--text-secondary); margin-bottom: 4px; display: flex; gap: 10px; }
    .tweet-tooltip .tt-impact { display: flex; gap: 12px; font-size: 12px; font-weight: 600; }
    .tweet-tooltip .tt-impact .positive { color: var(--green-bright); }
    .tweet-tooltip .tt-impact .negative { color: var(--red); }

    /* ===== Footer Bar ===== */
    .footer-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 6px 16px;
      background: var(--bg-secondary);
      border-top: 1px solid var(--border);
      font-size: 12px;
      color: var(--text-secondary);
    }

    .footer-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .footer-right {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .legend-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }
    .legend-dot.positive { background: var(--green); }
    .legend-dot.negative { background: var(--red); }
    .legend-dot.cluster { background: var(--purple); }

    /* ===== Timeframe Buttons ===== */
    .timeframe-bar {
      position: absolute;
      bottom: 12px;
      left: 12px;
      display: flex;
      gap: 2px;
      z-index: 15;
      background: rgba(19, 23, 34, 0.85);
      border-radius: 6px;
      padding: 2px;
    }

    .tf-btn {
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      color: var(--text-secondary);
      background: transparent;
      border: none;
      transition: all 0.15s;
    }
    .tf-btn:hover { color: var(--text-primary); }
    .tf-btn.active { color: #fff; background: var(--accent); }

    /* ===== Data Table View ===== */
    .data-table-view {
      display: none;
      padding: 0;
      overflow-x: auto;
    }
    .data-table-view.active { display: block; }

    .data-table-controls {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border);
    }

    .search-input {
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 8px 14px;
      color: var(--text-primary);
      font-size: 13px;
      width: 260px;
      outline: none;
      transition: border-color 0.2s;
    }
    .search-input:focus { border-color: var(--accent); }
    .search-input::placeholder { color: var(--text-muted); }

    .export-btn {
      padding: 8px 16px;
      background: var(--bg-tertiary);
      color: var(--text-primary);
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.15s;
    }
    .export-btn:hover { background: var(--bg-hover); border-color: var(--accent); }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }

    thead th {
      padding: 10px 12px;
      text-align: left;
      background: var(--bg-tertiary);
      color: var(--text-secondary);
      font-weight: 600;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      cursor: pointer;
      user-select: none;
      position: sticky;
      top: 0;
      border-bottom: 1px solid var(--border);
    }
    thead th:hover { color: var(--text-primary); }
    thead th .sort-arrow { margin-left: 4px; opacity: 0.4; }
    thead th.sorted .sort-arrow { opacity: 1; color: var(--accent); }

    tbody tr {
      border-bottom: 1px solid var(--border);
      transition: background 0.1s;
      cursor: pointer;
    }
    tbody tr:hover { background: var(--bg-hover); }

    td {
      padding: 10px 12px;
      white-space: nowrap;
    }
    td.tweet-text-cell {
      white-space: normal;
      max-width: 320px;
      line-height: 1.4;
    }

    .change-positive { color: var(--green-bright); font-weight: 600; }
    .change-negative { color: var(--red); font-weight: 600; }
    .change-neutral { color: var(--text-secondary); }

    /* ===== About View ===== */
    .about-view {
      display: none;
      padding: 32px;
      max-width: 900px;
      margin: 0 auto;
    }
    .about-view.active { display: block; }

    .about-hero {
      text-align: center;
      margin-bottom: 48px;
    }

    .about-hero h1 {
      font-size: 32px;
      margin-bottom: 12px;
      background: linear-gradient(135deg, var(--accent), var(--purple));
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .about-hero p {
      font-size: 16px;
      color: var(--text-secondary);
      max-width: 500px;
      margin: 0 auto;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 16px;
      margin-bottom: 40px;
    }

    .stat-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
    }

    .stat-value {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .stat-label {
      font-size: 12px;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .about-section {
      margin-bottom: 32px;
    }

    .about-section h3 {
      font-size: 18px;
      margin-bottom: 12px;
      color: var(--text-primary);
    }

    .about-section p, .about-section li {
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.6;
    }

    .about-section ul {
      list-style: none;
      padding: 0;
    }

    .about-section li::before {
      content: '‚Üí ';
      color: var(--accent);
    }

    .daily-comparison {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin-bottom: 32px;
    }

    .comparison-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
    }

    .comparison-card h4 {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .comparison-card .big-num {
      font-size: 36px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .comparison-card .sub-stat {
      font-size: 13px;
      color: var(--text-secondary);
      margin-top: 4px;
    }

    .impact-scatter {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 32px;
    }

    .impact-scatter h3 {
      font-size: 16px;
      margin-bottom: 16px;
    }

    #impactCanvas {
      width: 100%;
      height: 280px;
    }

    .credit-link {
      color: var(--text-muted);
      text-decoration: none;
      transition: color 0.2s;
    }
    .credit-link:hover { color: var(--accent); }

    /* Loading */
    .loading-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(10, 10, 15, 0.9);
      z-index: 200;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 16px;
    }
    .loading-overlay.active { display: flex; }

    .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    .loading-text { font-size: 14px; color: var(--text-secondary); }

    /* ===== Responsive ===== */
    @media (max-width: 768px) {
      .topbar { flex-wrap: wrap; gap: 8px; }
      .chart-container { height: calc(100vh - 180px); min-height: 400px; }
      .asset-dropdown { width: 280px; }
      .about-view { padding: 20px; }
      .stats-grid { grid-template-columns: repeat(2, 1fr); }
      .daily-comparison { grid-template-columns: 1fr; }
      .tweet-tooltip { width: 240px; }
    }
  </style>
</head>
<body>

<!-- Top Bar -->
<div class="topbar">
  <div class="topbar-left">
    <div class="asset-selector" id="assetSelector">
      <span class="asset-color-dot" id="assetDot" style="background:#9945FF"></span>
      <span class="token-name" id="tokenName">Loading...</span>
      <span class="token-badge" id="tokenNetwork">‚Äî</span>
      <span class="founder-tag" id="founderTag">@‚Äî</span>
      <span class="selector-arrow">‚ñº</span>
      <div class="asset-dropdown" id="assetDropdown"></div>
    </div>
    <span class="token-pair">/USD</span>
  </div>
  <div class="topbar-right">
    <button class="view-tab active" data-view="chart">Chart</button>
    <button class="view-tab" data-view="data">Data Table</button>
    <button class="view-tab" data-view="about">About</button>
  </div>
</div>

<!-- ===== CHART VIEW ===== -->
<div id="chartView">
  <div class="chart-header">
    <div class="chart-header-left">
      <button class="chart-tab active" data-range="tweets">üê¶ Tweets</button>
      <button class="chart-tab" data-range="first">First Tweet</button>
      <button class="chart-tab" data-range="all">All Time</button>
      <button class="chart-tab" data-range="last">Last Tweet</button>
    </div>
    <div class="chart-header-right">
      <span id="priceDisplay">‚Äî</span>
    </div>
  </div>

  <div class="chart-container">
    <div id="chart"></div>
    <div class="tweet-markers-layer" id="markersLayer"></div>
    <div class="timeframe-bar">
      <button class="tf-btn" data-tf="15m" data-file="prices_15m.json">15m</button>
      <button class="tf-btn" data-tf="1h" data-file="prices_1h.json">1h</button>
      <button class="tf-btn active" data-tf="1D" data-file="prices_1d.json">1D</button>
    </div>
  </div>

  <div class="footer-bar">
    <div class="footer-left">
      <span id="founderHandle">@‚Äî</span>
      <span id="tweetCountInfo">‚Äî</span>
    </div>
    <div class="footer-right">
      <span class="legend-item"><span class="legend-dot positive"></span> Price up</span>
      <span class="legend-item"><span class="legend-dot negative"></span> Price down</span>
      <span class="legend-item"><span class="legend-dot cluster"></span> Multi-tweet day</span>
      <span id="dateRangeInfo">‚Äî</span>
    </div>
  </div>
</div>

<!-- ===== DATA TABLE VIEW ===== -->
<div class="data-table-view" id="dataView">
  <div class="data-table-controls">
    <input type="text" class="search-input" id="tableSearch" placeholder="Search tweets...">
    <button class="export-btn" id="exportCSV">üì• Export CSV</button>
  </div>
  <table>
    <thead>
      <tr>
        <th data-sort="timestamp">Date <span class="sort-arrow">‚Üï</span></th>
        <th data-sort="text">Tweet <span class="sort-arrow">‚Üï</span></th>
        <th data-sort="price_at_tweet">Price <span class="sort-arrow">‚Üï</span></th>
        <th data-sort="likes">Likes <span class="sort-arrow">‚Üï</span></th>
        <th data-sort="retweets">Retweets <span class="sort-arrow">‚Üï</span></th>
        <th data-sort="impressions">Impressions <span class="sort-arrow">‚Üï</span></th>
        <th data-sort="change_1h_pct">1h Impact <span class="sort-arrow">‚Üï</span></th>
        <th data-sort="change_24h_pct">24h Impact <span class="sort-arrow">‚Üï</span></th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>
</div>

<!-- ===== ABOUT VIEW ===== -->
<div class="about-view" id="aboutView">
  <div class="about-hero">
    <h1>Tweet-Price Correlation</h1>
    <p>Most founder tweets do nothing. Some coincide with big moves. This tool helps you see which.</p>
  </div>

  <div class="stats-grid" id="statsGrid"></div>

  <div class="daily-comparison" id="dailyComparison"></div>

  <div class="impact-scatter about-section">
    <h3>Impact Explorer ‚Äî Tweets vs 24h Price Change</h3>
    <canvas id="impactCanvas"></canvas>
  </div>

  <div class="about-section">
    <h3>How It Works</h3>
    <ul>
      <li>Track founder tweet timestamps from X/Twitter</li>
      <li>Align each tweet to the nearest price candle on-chain</li>
      <li>Measure 1h and 24h price change after each tweet</li>
      <li>Compare tweet-day returns vs no-tweet-day returns</li>
      <li>15 tokens tracked with 4,700+ tweet events</li>
    </ul>
  </div>

  <div class="about-section" style="text-align: center; margin-top: 40px;">
    <p style="font-size: 12px;">
      Data from <a href="https://github.com/rohunvora/tweet-price-charts" class="credit-link" target="_blank">tweet-price-charts</a> by rohunvora
      ¬∑ Built with <a href="https://github.com/nirholas/XActions" class="credit-link" target="_blank">XActions</a> by nichxbt
    </p>
  </div>
</div>

<!-- Loading Overlay -->
<div class="loading-overlay" id="loadingOverlay">
  <div class="spinner"></div>
  <div class="loading-text" id="loadingText">Loading data...</div>
</div>

<script>
// ============================================================================
// XActions Tweet-Price Correlation Dashboard
// Real data from https://github.com/rohunvora/tweet-price-charts
// by nichxbt
// ============================================================================

(() => {
  'use strict';

  // ===== Configuration =====
  const DATA_BASE = 'data/tweet-price';
  const DEFAULT_ASSET = 'pump';

  // ===== State =====
  const state = {
    assets: [],
    currentAsset: null,
    events: [],
    candles: [],
    stats: null,
    assetMeta: null,
    view: 'chart',
    timeframe: '1D',
    chartRange: 'tweets',
    sortCol: 'change_24h_pct',
    sortDir: -1,
    searchQuery: '',
    chart: null,
    candleSeries: null,
    priceFileMap: {
      '15m': 'prices_15m.json',
      '1h': 'prices_1h.json',
      '1D': 'prices_1d.json',
    },
  };

  // ===== DOM Refs =====
  const $ = (sel) => document.querySelector(sel);
  const $$ = (sel) => document.querySelectorAll(sel);

  // ===== Boot =====
  async function init() {
    showLoading('Loading assets...');
    try {
      const resp = await fetch(`${DATA_BASE}/assets.json`);
      if (!resp.ok) throw new Error('Could not load assets.json');
      const data = await resp.json();
      state.assets = data.assets.filter(a => a.enabled !== false);

      buildAssetDropdown();
      wireEvents();

      // Load default asset (or from URL hash)
      const hash = window.location.hash.replace('#', '');
      const startAsset = state.assets.find(a => a.id === hash) ? hash : DEFAULT_ASSET;
      await loadAsset(startAsset);

      hideLoading();
    } catch (err) {
      hideLoading();
      console.error('Init error:', err);
      $('#tokenName').textContent = 'Error loading data';
    }
  }

  // ===== Asset Dropdown =====
  function buildAssetDropdown() {
    const dropdown = $('#assetDropdown');
    dropdown.innerHTML = state.assets.map(a => `
      <div class="asset-dropdown-item" data-asset="${a.id}">
        <span class="item-color" style="background:${a.color || '#888'}"></span>
        <span class="item-name">$${a.name}</span>
        <span class="item-founder">@${a.founder}</span>
        <span class="item-network">${a.network}</span>
      </div>
    `).join('');

    // Asset selector toggle
    const selector = $('#assetSelector');
    selector.addEventListener('click', (e) => {
      if (e.target.closest('.asset-dropdown-item')) return;
      selector.classList.toggle('open');
    });

    // Click an asset
    dropdown.addEventListener('click', async (e) => {
      const item = e.target.closest('.asset-dropdown-item');
      if (!item) return;
      selector.classList.remove('open');
      const assetId = item.dataset.asset;
      if (assetId !== state.currentAsset) {
        showLoading(`Loading $${state.assets.find(a => a.id === assetId)?.name || assetId}...`);
        await loadAsset(assetId);
        hideLoading();
      }
    });

    // Close dropdown on outside click
    document.addEventListener('click', (e) => {
      if (!e.target.closest('.asset-selector')) {
        selector.classList.remove('open');
      }
    });
  }

  // ===== Load Asset Data =====
  async function loadAsset(assetId) {
    const asset = state.assets.find(a => a.id === assetId);
    if (!asset) return;

    state.currentAsset = assetId;
    state.assetMeta = asset;
    window.location.hash = assetId;

    // Fetch tweet events + prices + stats in parallel
    const priceFile = state.priceFileMap[state.timeframe] || 'prices_1d.json';
    const [eventsResp, pricesResp, statsResp] = await Promise.all([
      fetch(`${DATA_BASE}/${assetId}/tweet_events.json`),
      fetch(`${DATA_BASE}/${assetId}/${priceFile}`),
      fetch(`${DATA_BASE}/${assetId}/stats.json`),
    ]);

    if (!eventsResp.ok) throw new Error(`No tweet events for ${assetId}`);
    if (!pricesResp.ok) throw new Error(`No price data for ${assetId}`);

    const eventsData = await eventsResp.json();
    const pricesData = await pricesResp.json();
    const statsData = statsResp.ok ? await statsResp.json() : null;

    state.events = eventsData.events || [];
    state.candles = pricesData.candles || [];
    state.stats = statsData;

    // Update active item in dropdown
    $$('.asset-dropdown-item').forEach(el => {
      el.classList.toggle('active', el.dataset.asset === assetId);
    });

    updateHeader();
    renderAll();
  }

  // ===== Switch Timeframe =====
  async function switchTimeframe(tf) {
    if (tf === state.timeframe) return;
    state.timeframe = tf;

    const priceFile = state.priceFileMap[tf];
    if (!priceFile || !state.currentAsset) return;

    showLoading(`Loading ${tf} candles...`);
    try {
      const resp = await fetch(`${DATA_BASE}/${state.currentAsset}/${priceFile}`);
      if (resp.ok) {
        const data = await resp.json();
        state.candles = data.candles || [];
        renderChart();
      } else {
        // Fallback: keep current candles, just notify
        console.warn(`${priceFile} not available for ${state.currentAsset}`);
      }
    } catch (err) {
      console.error('Timeframe switch error:', err);
    }
    hideLoading();
  }

  // ===== Update Header =====
  function updateHeader() {
    const a = state.assetMeta;
    if (!a) return;

    $('#tokenName').textContent = `$${a.name}`;
    $('#tokenNetwork').textContent = a.network;
    $('#assetDot').style.background = a.color || '#888';
    $('#founderTag').textContent = `@${a.founder}`;
    $('#founderHandle').textContent = `@${a.founder}`;
    $('#tweetCountInfo').textContent = `${state.events.length} tweets`;

    if (state.stats?.summary?.date_range) {
      const dr = state.stats.summary.date_range;
      $('#dateRangeInfo').textContent = `${dr.start} ‚Äî ${dr.end}`;
    }
  }

  // ===== Wire Events =====
  function wireEvents() {
    // View tabs
    $$('.view-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        $$('.view-tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        state.view = tab.dataset.view;
        updateView();
      });
    });

    // Chart range tabs
    $$('.chart-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        $$('.chart-tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        state.chartRange = tab.dataset.range;
        fitChartRange();
      });
    });

    // Timeframe buttons
    $$('.tf-btn').forEach(btn => {
      btn.addEventListener('click', async () => {
        $$('.tf-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        await switchTimeframe(btn.dataset.tf);
      });
    });

    // Table sort
    $$('thead th').forEach(th => {
      th.addEventListener('click', () => {
        const col = th.dataset.sort;
        if (!col) return;
        if (state.sortCol === col) state.sortDir *= -1;
        else { state.sortCol = col; state.sortDir = -1; }
        renderTable();
      });
    });

    // Table search
    $('#tableSearch').addEventListener('input', (e) => {
      state.searchQuery = e.target.value;
      renderTable();
    });

    // CSV export
    $('#exportCSV').addEventListener('click', exportCSV);
  }

  // ===== View Switching =====
  function updateView() {
    $('#chartView').style.display = state.view === 'chart' ? '' : 'none';
    $('#dataView').classList.toggle('active', state.view === 'data');
    $('#aboutView').classList.toggle('active', state.view === 'about');
    if (state.view === 'data') renderTable();
    if (state.view === 'about') renderAbout();
  }

  // ===== Render All =====
  function renderAll() {
    renderChart();
    if (state.view === 'data') renderTable();
    if (state.view === 'about') renderAbout();
  }

  // ===== CHART RENDERING =====
  function renderChart() {
    const chartEl = $('#chart');
    chartEl.innerHTML = '';
    $('#markersLayer').innerHTML = '';

    const candles = state.candles;
    if (!candles.length) {
      chartEl.innerHTML = '<p style="text-align:center;padding:60px;color:var(--text-secondary)">No price data available for this timeframe</p>';
      return;
    }

    // Convert candles: {t, o, h, l, c, v} ‚Üí TradingView format
    const isIntraday = state.timeframe !== '1D';
    const chartData = candles.map(c => {
      if (isIntraday) {
        return { time: c.t, open: c.o, high: c.h, low: c.l, close: c.c };
      } else {
        // Daily: convert unix timestamp to YYYY-MM-DD
        const d = new Date(c.t * 1000);
        const day = `${d.getUTCFullYear()}-${String(d.getUTCMonth()+1).padStart(2,'0')}-${String(d.getUTCDate()).padStart(2,'0')}`;
        return { time: day, open: c.o, high: c.h, low: c.l, close: c.c };
      }
    });

    // Create chart
    const chart = LightweightCharts.createChart(chartEl, {
      width: chartEl.clientWidth,
      height: chartEl.clientHeight,
      layout: {
        background: { type: 'solid', color: '#131722' },
        textColor: '#787b86',
        fontSize: 12,
      },
      grid: {
        vertLines: { color: '#1e222d' },
        horzLines: { color: '#1e222d' },
      },
      crosshair: {
        mode: LightweightCharts.CrosshairMode.Normal,
        vertLine: { color: '#555', width: 1, style: LightweightCharts.LineStyle.Dashed },
        horzLine: { color: '#555', width: 1, style: LightweightCharts.LineStyle.Dashed },
      },
      rightPriceScale: {
        borderColor: '#2a2e39',
        scaleMargins: { top: 0.1, bottom: 0.1 },
      },
      timeScale: {
        borderColor: '#2a2e39',
        timeVisible: isIntraday,
        secondsVisible: false,
      },
      handleScroll: { vertTouchDrag: false },
    });

    const candleSeries = chart.addCandlestickSeries({
      upColor: '#26a69a',
      downColor: '#ef5350',
      borderUpColor: '#26a69a',
      borderDownColor: '#ef5350',
      wickUpColor: '#26a69a',
      wickDownColor: '#ef5350',
    });

    candleSeries.setData(chartData);

    // Add tweet markers on TradingView chart
    const tweetMarkers = buildTweetMarkers();
    if (tweetMarkers.length) {
      candleSeries.setMarkers(tweetMarkers);
    }

    state.chart = chart;
    state.candleSeries = candleSeries;

    // Resize handler
    const resizeObs = new ResizeObserver(() => {
      chart.applyOptions({ width: chartEl.clientWidth, height: chartEl.clientHeight });
    });
    resizeObs.observe(chartEl);

    // Price display on crosshair move
    chart.subscribeCrosshairMove(param => {
      if (param.time) {
        const data = param.seriesData.get(candleSeries);
        if (data) {
          const c = data.close;
          const o = data.open;
          const pct = ((c - o) / o * 100).toFixed(2);
          const color = c >= o ? 'var(--green-bright)' : 'var(--red)';
          $('#priceDisplay').innerHTML = `<span style="color:${color}">$${formatPrice(c)} (${pct > 0 ? '+' : ''}${pct}%)</span>`;
        }
      }
    });

    fitChartRange();

    // Overlay HTML tweet markers (avatar bubbles)
    renderMarkerOverlays(chart, candleSeries);
  }

  function buildTweetMarkers() {
    const isIntraday = state.timeframe !== '1D';

    // Group events by time bucket
    const bucketMap = new Map();
    for (const evt of state.events) {
      let key;
      if (isIntraday) {
        // Round to nearest candle time
        key = evt.timestamp;
      } else {
        const d = new Date(evt.timestamp * 1000);
        key = `${d.getUTCFullYear()}-${String(d.getUTCMonth()+1).padStart(2,'0')}-${String(d.getUTCDate()).padStart(2,'0')}`;
      }
      if (!bucketMap.has(key)) bucketMap.set(key, []);
      bucketMap.get(key).push(evt);
    }

    const markers = [];
    bucketMap.forEach((events, time) => {
      const change24 = events[0]?.change_24h_pct;
      const color = change24 != null ? (change24 > 0 ? '#26a69a' : '#ef5350') : '#a855f7';
      markers.push({
        time: isIntraday ? time : time,
        position: 'aboveBar',
        color,
        shape: 'circle',
        text: events.length > 1 ? String(events.length) : 'üê¶',
        size: events.length > 3 ? 2 : 1,
      });
    });

    return markers.sort((a, b) => {
      if (typeof a.time === 'string') return a.time.localeCompare(b.time);
      return a.time - b.time;
    });
  }

  function renderMarkerOverlays(chart, series) {
    const layer = $('#markersLayer');
    layer.innerHTML = '';
    const isIntraday = state.timeframe !== '1D';

    // Group events by day for overlays
    const dayMap = new Map();
    for (const evt of state.events) {
      const d = new Date(evt.timestamp * 1000);
      const key = isIntraday
        ? evt.timestamp
        : `${d.getUTCFullYear()}-${String(d.getUTCMonth()+1).padStart(2,'0')}-${String(d.getUTCDate()).padStart(2,'0')}`;
      if (!dayMap.has(key)) dayMap.set(key, []);
      dayMap.get(key).push(evt);
    }

    const updatePositions = () => {
      layer.innerHTML = '';
      const timeScale = chart.timeScale();

      dayMap.forEach((events, time) => {
        const x = timeScale.timeToCoordinate(time);
        if (x === null || x < 0) return;

        const highPrice = Math.max(...events.map(e => e.price_at_tweet || 0));
        if (!highPrice) return;
        const y = series.priceToCoordinate(highPrice);
        if (y === null) return;

        const count = events.length;
        const first = events[0];
        const change24 = first.change_24h_pct;
        const borderColor = change24 != null ? (change24 > 0 ? 'var(--green)' : 'var(--red)') : 'var(--purple)';

        const marker = document.createElement('div');
        marker.className = 'tweet-marker';
        marker.style.left = (x - 16) + 'px';
        marker.style.top = (y - 48) + 'px';

        const avatarHTML = `<div class="marker-avatar" style="border-color:${borderColor}">üê¶</div>`;
        const countHTML = count > 1 ? `<div class="marker-count">${count}</div>` : '';

        const dateStr = new Date(first.timestamp * 1000).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric', hour: '2-digit', minute: '2-digit' });
        const statsHTML = `<div class="tt-stats">‚ù§Ô∏è ${fmtNum(first.likes)} ¬∑ üîÅ ${fmtNum(first.retweets)} ¬∑ üëÅ ${fmtNum(first.impressions)}</div>`;
        const impactHTML = [];
        if (first.change_1h_pct != null) {
          const c = first.change_1h_pct;
          impactHTML.push(`<span class="${c >= 0 ? 'positive' : 'negative'}">1h: ${c > 0 ? '+' : ''}${c.toFixed(2)}%</span>`);
        }
        if (first.change_24h_pct != null) {
          const c = first.change_24h_pct;
          impactHTML.push(`<span class="${c >= 0 ? 'positive' : 'negative'}">24h: ${c > 0 ? '+' : ''}${c.toFixed(2)}%</span>`);
        }

        marker.innerHTML = `
          ${avatarHTML}${countHTML}
          <div class="tweet-tooltip">
            <div class="tt-date">${dateStr} ¬∑ ${count} tweet${count > 1 ? 's' : ''} ¬∑ $${formatPrice(first.price_at_tweet)}</div>
            <div class="tt-text">${escapeHtml((first.text || '').substring(0, 160))}${(first.text || '').length > 160 ? '...' : ''}</div>
            ${statsHTML}
            <div class="tt-impact">${impactHTML.join(' ')}</div>
          </div>
        `;

        marker.addEventListener('click', () => {
          if (first.tweet_id) window.open(`https://x.com/${state.assetMeta?.founder}/status/${first.tweet_id}`, '_blank');
        });

        layer.appendChild(marker);
      });
    };

    updatePositions();
    chart.timeScale().subscribeVisibleLogicalRangeChange(updatePositions);
    window.addEventListener('resize', updatePositions);
  }

  function fitChartRange() {
    if (!state.chart || !state.events.length) return;
    const ts = state.chart.timeScale();
    const isIntraday = state.timeframe !== '1D';

    const timestamps = state.events.map(e => e.timestamp).sort((a, b) => a - b);
    const first = timestamps[0];
    const last = timestamps[timestamps.length - 1];

    const toTime = (unix, offsetDays = 0) => {
      const adjusted = unix + offsetDays * 86400;
      if (isIntraday) return adjusted;
      const d = new Date(adjusted * 1000);
      return `${d.getUTCFullYear()}-${String(d.getUTCMonth()+1).padStart(2,'0')}-${String(d.getUTCDate()).padStart(2,'0')}`;
    };

    try {
      switch (state.chartRange) {
        case 'first':
          ts.setVisibleRange({ from: toTime(first, -1), to: toTime(first, 7) });
          break;
        case 'last':
          ts.setVisibleRange({ from: toTime(last, -7), to: toTime(last, 1) });
          break;
        case 'tweets':
          ts.setVisibleRange({ from: toTime(first, -2), to: toTime(last, 2) });
          break;
        default:
          ts.fitContent();
      }
    } catch {
      ts.fitContent();
    }
  }

  // ===== DATA TABLE =====
  function renderTable() {
    let rows = state.events.map(e => ({ ...e }));

    // Filter
    if (state.searchQuery) {
      const q = state.searchQuery.toLowerCase();
      rows = rows.filter(r => (r.text || '').toLowerCase().includes(q));
    }

    // Sort
    rows.sort((a, b) => {
      let va = a[state.sortCol] ?? -Infinity;
      let vb = b[state.sortCol] ?? -Infinity;
      if (typeof va === 'string') return va.localeCompare(vb) * state.sortDir;
      return (va > vb ? 1 : va < vb ? -1 : 0) * state.sortDir;
    });

    const tbody = $('#tableBody');
    tbody.innerHTML = rows.map(r => {
      const dateStr = new Date(r.timestamp * 1000).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: '2-digit', hour: '2-digit', minute: '2-digit' });
      const c1h = r.change_1h_pct;
      const c24h = r.change_24h_pct;
      return `
      <tr onclick="window.open('https://x.com/${state.assetMeta?.founder}/status/${r.tweet_id}', '_blank')">
        <td>${dateStr}</td>
        <td class="tweet-text-cell">${escapeHtml((r.text || '').substring(0, 140))}${(r.text || '').length > 140 ? '...' : ''}</td>
        <td>$${formatPrice(r.price_at_tweet)}</td>
        <td>${fmtNum(r.likes || 0)}</td>
        <td>${fmtNum(r.retweets || 0)}</td>
        <td>${fmtNum(r.impressions || 0)}</td>
        <td class="${c1h != null ? (c1h >= 0 ? 'change-positive' : 'change-negative') : 'change-neutral'}">${c1h != null ? (c1h > 0 ? '+' : '') + c1h.toFixed(2) + '%' : '‚Äî'}</td>
        <td class="${c24h != null ? (c24h >= 0 ? 'change-positive' : 'change-negative') : 'change-neutral'}">${c24h != null ? (c24h > 0 ? '+' : '') + c24h.toFixed(2) + '%' : '‚Äî'}</td>
      </tr>`;
    }).join('');

    // Update sort arrows
    $$('thead th').forEach(th => {
      th.classList.toggle('sorted', th.dataset.sort === state.sortCol);
    });
  }

  // ===== CSV Export =====
  function exportCSV() {
    if (!state.events.length) return;
    const headers = ['date', 'tweet_id', 'text', 'price_at_tweet', 'likes', 'retweets', 'replies', 'impressions', 'change_1h_pct', 'change_24h_pct', 'market_cap_at_tweet'];
    const csvRows = state.events.map(e => {
      return [
        e.timestamp_iso || new Date(e.timestamp * 1000).toISOString(),
        e.tweet_id || '',
        `"${(e.text || '').replace(/"/g, '""')}"`,
        e.price_at_tweet ?? '',
        e.likes ?? '',
        e.retweets ?? '',
        e.replies ?? '',
        e.impressions ?? '',
        e.change_1h_pct ?? '',
        e.change_24h_pct ?? '',
        e.market_cap_at_tweet ?? '',
      ].join(',');
    });
    const csv = [headers.join(','), ...csvRows].join('\n');
    downloadBlob(csv, `tweet-price-${state.currentAsset}-${state.assetMeta?.founder || 'export'}.csv`, 'text/csv');
  }

  // ===== ABOUT VIEW =====
  function renderAbout() {
    const stats = state.stats;
    if (!stats) {
      $('#statsGrid').innerHTML = '<p style="color:var(--text-secondary)">No statistics available for this asset</p>';
      $('#dailyComparison').innerHTML = '';
      return;
    }

    const s = stats.summary || {};
    const dc = stats.daily_comparison || {};

    // Stats cards
    $('#statsGrid').innerHTML = [
      { value: s.total_tweets || state.events.length, label: 'Total Tweets' },
      { value: (dc.tweet_day_avg_return != null ? dc.tweet_day_avg_return.toFixed(2) + '%' : '‚Äî'), label: 'Avg Tweet-Day Return', color: dc.tweet_day_avg_return >= 0 ? 'var(--green-bright)' : 'var(--red)' },
      { value: (dc.tweet_day_win_rate != null ? dc.tweet_day_win_rate + '%' : '‚Äî'), label: 'Tweet-Day Win Rate', color: dc.tweet_day_win_rate >= 50 ? 'var(--green-bright)' : 'var(--red)' },
      { value: s.total_days_analyzed || '‚Äî', label: 'Days Analyzed' },
      { value: (dc.no_tweet_day_avg_return != null ? dc.no_tweet_day_avg_return.toFixed(2) + '%' : '‚Äî'), label: 'Avg No-Tweet Return', color: dc.no_tweet_day_avg_return >= 0 ? 'var(--green-bright)' : 'var(--red)' },
      { value: (dc.no_tweet_day_win_rate != null ? dc.no_tweet_day_win_rate + '%' : '‚Äî'), label: 'No-Tweet Win Rate', color: dc.no_tweet_day_win_rate >= 50 ? 'var(--green-bright)' : 'var(--red)' },
    ].map(c => `
      <div class="stat-card">
        <div class="stat-value" ${c.color ? `style="color:${c.color}"` : ''}>${c.value}</div>
        <div class="stat-label">${c.label}</div>
      </div>
    `).join('');

    // Daily comparison cards
    if (dc.tweet_day_distribution && dc.no_tweet_day_distribution) {
      const td = dc.tweet_day_distribution;
      const nd = dc.no_tweet_day_distribution;
      $('#dailyComparison').innerHTML = `
        <div class="comparison-card">
          <h4>üìÖ Tweet Days (${dc.tweet_day_count || td.count})</h4>
          <div class="big-num" style="color:${dc.tweet_day_avg_return >= 0 ? 'var(--green-bright)' : 'var(--red)'}">
            ${dc.tweet_day_avg_return > 0 ? '+' : ''}${dc.tweet_day_avg_return?.toFixed(2) || '0'}%
          </div>
          <div class="sub-stat">Median: ${td.median?.toFixed(2)}% ¬∑ Std: ${td.std_dev?.toFixed(2)}%</div>
          <div class="sub-stat">Min: ${td.min?.toFixed(2)}% ¬∑ Max: +${td.max?.toFixed(2)}%</div>
          <div class="sub-stat">Win rate: ${dc.tweet_day_win_rate}% (${td.positive_count}‚Üë / ${td.negative_count}‚Üì)</div>
        </div>
        <div class="comparison-card">
          <h4>ü§´ No-Tweet Days (${dc.no_tweet_day_count || nd.count})</h4>
          <div class="big-num" style="color:${dc.no_tweet_day_avg_return >= 0 ? 'var(--green-bright)' : 'var(--red)'}">
            ${dc.no_tweet_day_avg_return > 0 ? '+' : ''}${dc.no_tweet_day_avg_return?.toFixed(2) || '0'}%
          </div>
          <div class="sub-stat">Median: ${nd.median?.toFixed(2)}% ¬∑ Std: ${nd.std_dev?.toFixed(2)}%</div>
          <div class="sub-stat">Min: ${nd.min?.toFixed(2)}% ¬∑ Max: +${nd.max?.toFixed(2)}%</div>
          <div class="sub-stat">Win rate: ${dc.no_tweet_day_win_rate}% (${nd.positive_count}‚Üë / ${nd.negative_count}‚Üì)</div>
        </div>
      `;
    } else {
      $('#dailyComparison').innerHTML = '';
    }

    // Impact scatter plot
    renderImpactScatter();
  }

  function renderImpactScatter() {
    const canvas = $('#impactCanvas');
    if (!canvas) return;
    const ctx = canvas.getContext('2d');
    const rect = canvas.parentElement.getBoundingClientRect();
    canvas.width = rect.width - 40;
    canvas.height = 280;

    const w = canvas.width;
    const h = canvas.height;
    const pad = { top: 20, right: 20, bottom: 30, left: 50 };

    ctx.clearRect(0, 0, w, h);

    const withImpact = state.events.filter(e => e.change_24h_pct != null);
    if (!withImpact.length) return;

    const changes = withImpact.map(e => e.change_24h_pct);
    const maxAbs = Math.max(Math.abs(Math.min(...changes)), Math.abs(Math.max(...changes)), 10);

    // Background
    ctx.fillStyle = '#1a1e2e';
    ctx.fillRect(0, 0, w, h);

    // Zero line
    const zeroY = pad.top + (h - pad.top - pad.bottom) / 2;
    ctx.strokeStyle = '#2a2e39';
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.moveTo(pad.left, zeroY);
    ctx.lineTo(w - pad.right, zeroY);
    ctx.stroke();

    // Axes labels
    ctx.fillStyle = '#787b86';
    ctx.font = '11px sans-serif';
    ctx.textAlign = 'right';
    ctx.fillText(`+${maxAbs.toFixed(0)}%`, pad.left - 6, pad.top + 4);
    ctx.fillText(`-${maxAbs.toFixed(0)}%`, pad.left - 6, h - pad.bottom + 4);
    ctx.fillText('0%', pad.left - 6, zeroY + 4);
    ctx.textAlign = 'center';
    ctx.fillText('Tweets over time ‚Üí', w / 2, h - 4);

    // Draw dots
    const plotW = w - pad.left - pad.right;
    const plotH = h - pad.top - pad.bottom;

    withImpact.forEach((e, i) => {
      const x = pad.left + (i / (withImpact.length - 1 || 1)) * plotW;
      const change = e.change_24h_pct;
      const y = zeroY - (change / maxAbs) * (plotH / 2);
      const r = Math.min(6, Math.max(3, Math.abs(change) / 5));

      ctx.beginPath();
      ctx.arc(x, y, r, 0, Math.PI * 2);
      ctx.fillStyle = change >= 0 ? 'rgba(38, 166, 154, 0.7)' : 'rgba(239, 83, 80, 0.7)';
      ctx.fill();
      ctx.strokeStyle = change >= 0 ? '#26a69a' : '#ef5350';
      ctx.lineWidth = 1;
      ctx.stroke();
    });
  }

  // ===== Utilities =====
  function showLoading(text) { $('#loadingOverlay').classList.add('active'); $('#loadingText').textContent = text; }
  function hideLoading() { $('#loadingOverlay').classList.remove('active'); }

  function formatPrice(p) {
    if (p == null) return '‚Äî';
    if (p >= 1) return p.toFixed(2);
    if (p >= 0.01) return p.toFixed(4);
    return p.toFixed(6);
  }

  function fmtNum(n) {
    if (n == null) return '‚Äî';
    if (n >= 1e6) return (n / 1e6).toFixed(1) + 'M';
    if (n >= 1e3) return (n / 1e3).toFixed(1) + 'K';
    return String(n);
  }

  function escapeHtml(s) {
    return s.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
  }

  function downloadBlob(content, filename, type) {
    const a = document.createElement('a');
    a.href = URL.createObjectURL(new Blob([content], { type }));
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
  }

  // ===== Init =====
  updateView();
  init();

})();
</script>
</body>
</html>
