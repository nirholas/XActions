<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title id="page-title">Thread Reader ‚Äî Read &amp; Summarize Twitter Threads | XActions</title>
  <meta name="description" id="page-description" content="Read, unroll, and summarize any Twitter/X thread. AI-powered summaries, clean reading experience. Free, no login required. By XActions.">
  <meta name="keywords" content="twitter thread reader, unroll twitter thread, x thread reader, thread unroller, read twitter thread, twitter thread summary, ai thread summary, xactions thread reader">
  <meta name="author" content="nich (@nichxbt)">
  <meta name="robots" content="index, follow">

  <!-- Open Graph -->
  <meta property="og:type" content="article">
  <meta property="og:title" id="og-title" content="Thread Reader ‚Äî XActions">
  <meta property="og:description" id="og-description" content="Read, unroll, and AI-summarize any Twitter/X thread. Free and open source.">
  <meta property="og:url" id="og-url" content="https://xactions.app/thread">
  <meta property="og:site_name" content="XActions">
  <meta property="og:image" content="https://xactions.app/og-thread-reader.png">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@nichxbt">
  <meta name="twitter:creator" content="@nichxbt">
  <meta name="twitter:title" id="tw-title" content="Thread Reader ‚Äî XActions">
  <meta name="twitter:description" id="tw-description" content="Read, unroll, and AI-summarize any Twitter/X thread.">

  <link rel="canonical" id="canonical-link" href="https://xactions.app/thread">
  <link rel="manifest" href="/manifest.json">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚ö°</text></svg>">

  <!-- Structured Data -->
  <script type="application/ld+json">
  {"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https://xactions.app"},{"@type":"ListItem","position":2,"name":"Thread Reader","item":"https://xactions.app/thread"}]}
  </script>
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "XActions Thread Reader",
    "description": "Read, unroll, and AI-summarize any Twitter/X thread. Free, no login required.",
    "url": "https://xactions.app/thread",
    "applicationCategory": "UtilityApplication",
    "operatingSystem": "Web Browser",
    "offers": { "@type": "Offer", "price": "0", "priceCurrency": "USD" }
  }
  </script>

  <style>
    /* ================================================================
       Design Tokens (matches XActions dashboard theme)
       ================================================================ */
    :root {
      --bg-primary: #000000;
      --bg-secondary: #16181c;
      --bg-tertiary: #202327;
      --bg-hover: #1d1f23;
      --accent: #1d9bf0;
      --accent-hover: #1a8cd8;
      --accent-light: rgba(29, 155, 240, 0.1);
      --text-primary: #e7e9ea;
      --text-secondary: #71767b;
      --text-link: #1d9bf0;
      --border: #2f3336;
      --success: #00ba7c;
      --warning: #ffad1f;
      --error: #f4212e;
      --verified: #1d9bf0;
      --card-bg: #16181c;
    }

    /* Light mode */
    [data-theme="light"] {
      --bg-primary: #ffffff;
      --bg-secondary: #f7f9f9;
      --bg-tertiary: #eff3f4;
      --bg-hover: #e7e7e8;
      --accent: #1d9bf0;
      --accent-hover: #1a8cd8;
      --accent-light: rgba(29, 155, 240, 0.1);
      --text-primary: #0f1419;
      --text-secondary: #536471;
      --text-link: #1d9bf0;
      --border: #eff3f4;
      --card-bg: #f7f9f9;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.5;
      min-height: 100vh;
      font-size: var(--font-size, 16px);
    }

    ::-webkit-scrollbar { width: 16px; }
    ::-webkit-scrollbar-track { background: var(--bg-primary); }
    ::-webkit-scrollbar-thumb { background: var(--bg-tertiary); border-radius: 8px; border: 4px solid var(--bg-primary); }
    ::-webkit-scrollbar-thumb:hover { background: var(--text-secondary); }

    /* ================================================================
       Layout ‚Äî 3-column like rest of dashboard
       ================================================================ */
    .layout { display: flex; max-width: 1300px; margin: 0 auto; min-height: 100vh; }

    /* Left Sidebar */
    .sidebar-left {
      width: 275px;
      padding: 0 12px;
      position: sticky;
      top: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
      border-right: 1px solid var(--border);
    }
    .logo { padding: 12px; margin-bottom: 4px; }
    .logo a { display: flex; align-items: center; gap: 8px; text-decoration: none; color: var(--text-primary); font-size: 1.5rem; font-weight: 800; padding: 12px; border-radius: 9999px; transition: background 0.2s; }
    .logo a:hover { background: var(--accent-light); }
    .logo-icon { font-size: 1.8rem; }

    nav { flex: 1; }
    .nav-item { display: flex; align-items: center; gap: 20px; padding: 12px; border-radius: 9999px; font-size: 1.25rem; font-weight: 400; color: var(--text-primary); text-decoration: none; transition: background 0.2s; margin-bottom: 4px; }
    .nav-item:hover { background: var(--bg-tertiary); }
    .nav-item.active { font-weight: 700; }
    .nav-icon { font-size: 1.5rem; width: 28px; text-align: center; }

    .action-btn { width: 90%; padding: 16px; background: var(--accent); color: white; border: none; border-radius: 9999px; font-size: 1.0625rem; font-weight: 700; cursor: pointer; transition: background 0.2s; margin: 16px 0; text-align: center; text-decoration: none; display: block; }
    .action-btn:hover { background: var(--accent-hover); }

    .user-menu { display: flex; align-items: center; gap: 12px; padding: 12px; border-radius: 9999px; text-decoration: none; color: var(--text-primary); transition: background 0.2s; margin-bottom: 12px; }
    .user-menu:hover { background: var(--bg-tertiary); }
    .user-avatar { width: 40px; height: 40px; border-radius: 50%; background: var(--bg-tertiary); display: flex; align-items: center; justify-content: center; font-weight: 700; }
    .user-info { flex: 1; min-width: 0; }
    .user-name { font-weight: 700; font-size: 0.9375rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .user-handle { color: var(--text-secondary); font-size: 0.8125rem; }
    .user-menu-dots { color: var(--text-secondary); }

    /* Main Content */
    .main-content { flex: 1; max-width: 600px; border-right: 1px solid var(--border); min-height: 100vh; }
    .main-header { position: sticky; top: 0; z-index: 100; background: rgba(0,0,0,0.65); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border-bottom: 1px solid var(--border); padding: 12px 16px; }
    [data-theme="light"] .main-header { background: rgba(255,255,255,0.85); }
    .header-title h1 { font-size: 1.25rem; font-weight: 800; }
    .header-title p { color: var(--text-secondary); font-size: 0.8125rem; }
    .header-row { display: flex; align-items: center; justify-content: space-between; }

    /* Right Sidebar */
    .sidebar-right {
      width: 350px;
      padding: 12px 24px;
      position: sticky;
      top: 0;
      height: 100vh;
      overflow-y: auto;
    }

    /* ================================================================
       Thread Reader ‚Äî Input Section
       ================================================================ */
    .input-section {
      padding: 32px 16px;
      text-align: center;
      border-bottom: 1px solid var(--border);
    }
    .input-hero-icon { font-size: 3rem; margin-bottom: 12px; }
    .input-hero-title { font-size: 1.5rem; font-weight: 800; margin-bottom: 8px; }
    .input-hero-subtitle { color: var(--text-secondary); font-size: 0.9375rem; margin-bottom: 24px; }

    .input-form { display: flex; gap: 12px; max-width: 520px; margin: 0 auto; }
    .input-form input {
      flex: 1;
      background: var(--bg-secondary);
      border: 2px solid var(--border);
      color: var(--text-primary);
      padding: 14px 18px;
      border-radius: 9999px;
      font-size: 1rem;
      outline: none;
      transition: border-color 0.2s;
    }
    .input-form input::placeholder { color: var(--text-secondary); }
    .input-form input:focus { border-color: var(--accent); }

    .read-btn {
      background: var(--accent);
      color: white;
      border: none;
      padding: 14px 28px;
      border-radius: 9999px;
      font-size: 1rem;
      font-weight: 700;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
      white-space: nowrap;
    }
    .read-btn:hover { background: var(--accent-hover); }
    .read-btn:active { transform: scale(0.97); }
    .read-btn:disabled { opacity: 0.5; cursor: not-allowed; }

    .input-error {
      color: var(--error);
      font-size: 0.875rem;
      margin-top: 12px;
      display: none;
    }
    .input-error.visible { display: block; }

    /* ================================================================
       Skeleton Loader
       ================================================================ */
    .skeleton-container { padding: 16px; display: none; }
    .skeleton-container.visible { display: block; }

    .skeleton-header { display: flex; align-items: center; gap: 12px; padding: 16px; margin-bottom: 16px; }
    .skeleton-avatar { width: 48px; height: 48px; border-radius: 50%; background: var(--bg-tertiary); animation: shimmer 1.5s infinite; }
    .skeleton-text { height: 14px; background: var(--bg-tertiary); border-radius: 4px; animation: shimmer 1.5s infinite; }
    .skeleton-text.w60 { width: 60%; }
    .skeleton-text.w40 { width: 40%; margin-top: 6px; }

    .skeleton-card {
      padding: 16px;
      border-bottom: 1px solid var(--border);
    }
    .skeleton-line { height: 12px; background: var(--bg-tertiary); border-radius: 4px; margin-bottom: 10px; animation: shimmer 1.5s infinite; }
    .skeleton-line:nth-child(1) { width: 95%; animation-delay: 0.1s; }
    .skeleton-line:nth-child(2) { width: 80%; animation-delay: 0.2s; }
    .skeleton-line:nth-child(3) { width: 70%; animation-delay: 0.3s; }

    @keyframes shimmer {
      0% { opacity: 0.3; }
      50% { opacity: 0.6; }
      100% { opacity: 0.3; }
    }

    /* ================================================================
       Thread Result
       ================================================================ */
    .thread-result { display: none; }
    .thread-result.visible { display: block; }

    /* Author Header */
    .author-header {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 20px 16px;
      border-bottom: 1px solid var(--border);
    }
    .author-avatar {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      object-fit: cover;
      background: var(--bg-tertiary);
    }
    .author-info { flex: 1; }
    .author-name { font-weight: 800; font-size: 1rem; }
    .author-username { color: var(--text-secondary); font-size: 0.9375rem; }
    .thread-meta { color: var(--text-secondary); font-size: 0.8125rem; margin-top: 2px; }

    /* AI Summary */
    .ai-summary {
      margin: 0;
      border-bottom: 1px solid var(--border);
      overflow: hidden;
    }
    .ai-summary-toggle {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 16px;
      cursor: pointer;
      user-select: none;
      background: transparent;
      transition: background 0.2s;
    }
    .ai-summary-toggle:hover { background: var(--bg-hover); }
    .ai-summary-label {
      font-weight: 700;
      font-size: 0.9375rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .ai-badge {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      font-size: 0.6875rem;
      font-weight: 700;
      padding: 2px 8px;
      border-radius: 9999px;
      letter-spacing: 0.5px;
      text-transform: uppercase;
    }
    .ai-summary-chevron {
      transition: transform 0.3s;
      color: var(--text-secondary);
      font-size: 1.25rem;
    }
    .ai-summary.open .ai-summary-chevron { transform: rotate(180deg); }

    .ai-summary-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.4s ease, padding 0.3s ease;
      padding: 0 16px;
    }
    .ai-summary.open .ai-summary-content {
      max-height: 500px;
      padding: 0 16px 16px;
    }

    .ai-summary-text {
      font-size: 0.9375rem;
      line-height: 1.6;
      color: var(--text-primary);
      margin-bottom: 12px;
    }
    .ai-key-points { list-style: none; padding: 0; }
    .ai-key-points li {
      position: relative;
      padding: 6px 0 6px 20px;
      font-size: 0.875rem;
      color: var(--text-primary);
      line-height: 1.5;
    }
    .ai-key-points li::before {
      content: '‚Üí';
      position: absolute;
      left: 0;
      color: var(--accent);
      font-weight: 700;
    }
    .ai-reading-time {
      margin-top: 8px;
      font-size: 0.8125rem;
      color: var(--text-secondary);
    }
    .ai-unavailable {
      font-size: 0.875rem;
      color: var(--text-secondary);
      font-style: italic;
    }

    /* Tweet Cards */
    .tweet-card {
      padding: 16px;
      border-bottom: 1px solid var(--border);
      transition: background 0.15s;
    }
    .tweet-card:hover { background: var(--bg-hover); }

    .tweet-number {
      display: inline-block;
      font-size: 0.75rem;
      font-weight: 700;
      color: var(--accent);
      background: var(--accent-light);
      padding: 2px 8px;
      border-radius: 9999px;
      margin-bottom: 8px;
    }
    .tweet-text {
      font-size: 0.9375rem;
      line-height: 1.6;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    .tweet-media {
      margin-top: 12px;
      border-radius: 16px;
      overflow: hidden;
    }
    .tweet-media img {
      width: 100%;
      border-radius: 16px;
      border: 1px solid var(--border);
    }
    .tweet-media video {
      width: 100%;
      border-radius: 16px;
      border: 1px solid var(--border);
    }
    .tweet-stats {
      display: flex;
      gap: 20px;
      margin-top: 10px;
      color: var(--text-secondary);
      font-size: 0.8125rem;
    }
    .tweet-stat { display: flex; align-items: center; gap: 4px; }
    .tweet-timestamp {
      color: var(--text-secondary);
      font-size: 0.75rem;
      margin-top: 4px;
    }

    /* Thread Footer */
    .thread-footer {
      padding: 20px 16px;
      border-bottom: 1px solid var(--border);
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
    }
    .footer-btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 16px;
      border-radius: 9999px;
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
      text-decoration: none;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--text-primary);
    }
    .footer-btn:hover {
      background: var(--bg-tertiary);
    }
    .footer-btn.primary {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }
    .footer-btn.primary:hover { background: var(--accent-hover); border-color: var(--accent-hover); }
    .footer-btn-icon { font-size: 1rem; }

    /* Toolbar */
    .toolbar {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .toolbar-btn {
      background: none;
      border: 1px solid var(--border);
      color: var(--text-secondary);
      padding: 6px 10px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.8125rem;
      transition: background 0.2s, color 0.2s;
    }
    .toolbar-btn:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }
    .toolbar-btn.active { color: var(--accent); border-color: var(--accent); }

    /* Toast notification */
    .toast {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%) translateY(80px);
      background: var(--accent);
      color: white;
      padding: 12px 24px;
      border-radius: 9999px;
      font-size: 0.875rem;
      font-weight: 600;
      opacity: 0;
      transition: transform 0.3s ease, opacity 0.3s ease;
      z-index: 9999;
      pointer-events: none;
    }
    .toast.visible {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    /* Bookmarklet */
    .bookmarklet-section {
      padding: 20px;
      border-radius: 12px;
      background: var(--bg-secondary);
      margin: 16px;
    }
    .bookmarklet-section h3 {
      font-size: 1rem;
      font-weight: 700;
      margin-bottom: 8px;
    }
    .bookmarklet-section p {
      color: var(--text-secondary);
      font-size: 0.8125rem;
      margin-bottom: 12px;
    }
    .bookmarklet-link {
      display: inline-block;
      padding: 10px 20px;
      background: var(--accent);
      color: white;
      text-decoration: none;
      border-radius: 9999px;
      font-size: 0.875rem;
      font-weight: 700;
      cursor: grab;
    }
    .bookmarklet-link:hover { background: var(--accent-hover); }

    /* Right sidebar panels */
    .sidebar-panel {
      background: var(--bg-secondary);
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 16px;
    }
    .sidebar-panel h3 {
      font-size: 1.25rem;
      font-weight: 800;
      margin-bottom: 12px;
    }
    .sidebar-panel p, .sidebar-panel li {
      color: var(--text-secondary);
      font-size: 0.8125rem;
      line-height: 1.6;
    }
    .sidebar-panel ul { list-style: none; }
    .sidebar-panel li { padding: 4px 0; }
    .sidebar-panel li::before { content: '‚úì '; color: var(--success); font-weight: 700; }

    /* Footer */
    .site-footer {
      border-top: 1px solid var(--border);
      padding: 48px 24px;
      background: var(--bg-primary);
    }
    .footer-content {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1fr 1fr 1fr 1fr;
      gap: 32px;
    }
    .footer-section h4 { font-size: 0.875rem; font-weight: 700; margin-bottom: 12px; color: var(--text-primary); }
    .footer-section p { color: var(--text-secondary); font-size: 0.875rem; line-height: 1.5; margin-bottom: 8px; }
    .footer-section a { display: block; color: var(--text-secondary); text-decoration: none; font-size: 0.875rem; padding: 4px 0; transition: color 0.2s; }
    .footer-section a:hover { color: var(--accent); }
    .footer-bottom { max-width: 1200px; margin: 24px auto 0; padding-top: 24px; border-top: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px; }
    .footer-bottom p { color: var(--text-secondary); font-size: 0.8125rem; }
    .footer-bottom a { color: var(--text-secondary); text-decoration: none; }
    .footer-bottom a:hover { color: var(--accent); }

    /* Print styles */
    @media print {
      .sidebar-left, .sidebar-right, .main-header, .input-section, .thread-footer, .toolbar, .site-footer { display: none !important; }
      .main-content { max-width: 100% !important; border: none !important; }
      .layout { display: block; }
      .tweet-card:hover { background: transparent; }
      body { background: white; color: black; font-size: 12pt; }
      .tweet-text { color: black; }
      .author-name { color: black; }
    }

    /* Responsive */
    @media (max-width: 1280px) { .sidebar-right { width: 290px; } }
    @media (max-width: 1024px) { .sidebar-right { display: none; } .main-content { max-width: 100%; } }
    @media (max-width: 768px) {
      .sidebar-left { width: 68px; padding: 0 4px; }
      .logo a span, .nav-item span, .user-info, .user-menu-dots { display: none; }
      .nav-item { justify-content: center; padding: 12px; }
      .action-btn { width: 50px; height: 50px; padding: 0; font-size: 0; }
      .action-btn::before { content: '+'; font-size: 1.5rem; }
      .user-menu { justify-content: center; }
      .input-form { flex-direction: column; }
      .input-hero-title { font-size: 1.25rem; }
    }
    @media (max-width: 480px) {
      .footer-content { grid-template-columns: 1fr; }
      .thread-footer { flex-direction: column; align-items: stretch; }
      .footer-btn { justify-content: center; }
    }

    /* Skip nav */
    .skip-nav { position: absolute; top: -100%; left: 16px; background: var(--accent); color: white; padding: 12px 24px; border-radius: 8px; font-weight: 700; z-index: 9999; text-decoration: none; }
    .skip-nav:focus { top: 16px; }
    :focus-visible { outline: 2px solid var(--accent); outline-offset: 2px; }
  </style>
</head>
<body>
  <a href="#main-content" class="skip-nav">Skip to main content</a>
  <div class="layout">
    <!-- Left Sidebar -->
    <aside class="sidebar-left" aria-label="Main navigation"></aside>
    <script src="/js/sidebar.js"></script>

    <!-- Main Content -->
    <main class="main-content" id="main-content">
      <header class="main-header">
        <div class="header-row">
          <div class="header-title">
            <h1>üßµ Thread Reader</h1>
            <p>Read &amp; summarize any Twitter/X thread</p>
          </div>
          <div class="toolbar">
            <button class="toolbar-btn" id="theme-toggle" title="Toggle dark/light mode">‚òÄÔ∏è</button>
            <button class="toolbar-btn" id="font-up" title="Increase font size">A+</button>
            <button class="toolbar-btn" id="font-down" title="Decrease font size">A‚àí</button>
          </div>
        </div>
      </header>

      <!-- Input Section -->
      <section class="input-section" id="input-section">
        <div class="input-hero-icon">üßµ</div>
        <h2 class="input-hero-title">Unroll any thread</h2>
        <p class="input-hero-subtitle">Paste a tweet URL and get a clean, readable thread with AI-powered summary</p>
        <form class="input-form" id="thread-form" autocomplete="off">
          <input type="url" id="thread-url" placeholder="Paste thread URL ‚Äî x.com/user/status/..." aria-label="Thread URL" required>
          <button type="submit" class="read-btn" id="read-btn">Read Thread</button>
        </form>
        <p class="input-error" id="input-error"></p>
      </section>

      <!-- Skeleton Loader -->
      <div class="skeleton-container" id="skeleton">
        <div class="skeleton-header">
          <div class="skeleton-avatar"></div>
          <div style="flex:1">
            <div class="skeleton-text w60"></div>
            <div class="skeleton-text w40"></div>
          </div>
        </div>
        <div class="skeleton-card"><div class="skeleton-line"></div><div class="skeleton-line"></div><div class="skeleton-line"></div></div>
        <div class="skeleton-card"><div class="skeleton-line"></div><div class="skeleton-line"></div><div class="skeleton-line"></div></div>
        <div class="skeleton-card"><div class="skeleton-line"></div><div class="skeleton-line"></div></div>
        <div class="skeleton-card"><div class="skeleton-line"></div><div class="skeleton-line"></div><div class="skeleton-line"></div></div>
      </div>

      <!-- Thread Result -->
      <div class="thread-result" id="thread-result">
        <!-- Author Header -->
        <div class="author-header" id="author-header">
          <img class="author-avatar" id="author-avatar" src="" alt="Author avatar">
          <div class="author-info">
            <div class="author-name" id="author-name"></div>
            <div class="author-username" id="author-username"></div>
            <div class="thread-meta" id="thread-meta"></div>
          </div>
        </div>

        <!-- AI Summary (collapsible) -->
        <div class="ai-summary" id="ai-summary">
          <div class="ai-summary-toggle" id="ai-summary-toggle" role="button" tabindex="0" aria-expanded="false">
            <div class="ai-summary-label">
              <span>‚ú® AI Summary</span>
              <span class="ai-badge">AI</span>
            </div>
            <span class="ai-summary-chevron">‚ñº</span>
          </div>
          <div class="ai-summary-content" id="ai-summary-content">
            <!-- Filled by JS -->
          </div>
        </div>

        <!-- Tweets Container -->
        <div id="tweets-container"></div>

        <!-- Thread Footer -->
        <div class="thread-footer" id="thread-footer">
          <a class="footer-btn primary" id="read-on-x" href="#" target="_blank" rel="noopener noreferrer">
            <span class="footer-btn-icon">ùïè</span> Read on X
          </a>
          <button class="footer-btn" id="copy-text-btn">
            <span class="footer-btn-icon">üìã</span> Copy as Text
          </button>
          <button class="footer-btn" id="copy-md-btn">
            <span class="footer-btn-icon">üìù</span> Copy as Markdown
          </button>
          <button class="footer-btn" id="save-pdf-btn">
            <span class="footer-btn-icon">üñ®</span> Save as PDF
          </button>
          <button class="footer-btn" id="share-btn">
            <span class="footer-btn-icon">üîó</span> Share
          </button>
        </div>
      </div>

      <!-- SEO Content (hidden thread text for indexing) -->
      <div id="seo-content" style="display:none" aria-hidden="true"></div>
    </main>

    <!-- Right Sidebar -->
    <aside class="sidebar-right">
      <div class="sidebar-panel">
        <h3>Thread Reader</h3>
        <p style="margin-bottom: 12px;">Paste any X/Twitter thread URL to get a clean, readable version with AI-powered summaries.</p>
        <ul>
          <li>AI-generated thread summary</li>
          <li>Clean reading experience</li>
          <li>Dark &amp; light mode</li>
          <li>Copy as text or markdown</li>
          <li>Save as PDF</li>
          <li>Shareable links</li>
        </ul>
      </div>

      <div class="bookmarklet-section" id="bookmarklet-section">
        <h3>‚ö° Bookmarklet</h3>
        <p>Drag this to your bookmarks bar. Click it on any X/Twitter thread to read it here.</p>
        <a class="bookmarklet-link" href="javascript:void(window.open('https://xactions.app/thread?url='+encodeURIComponent(location.href)))" onclick="event.preventDefault();">
          üìñ Read Thread
        </a>
      </div>

      <div class="sidebar-panel">
        <h3>How it works</h3>
        <p><strong>1.</strong> Paste the URL of any tweet in a thread</p>
        <p><strong>2.</strong> We extract all tweets by the author in order</p>
        <p><strong>3.</strong> AI generates a concise summary</p>
        <p><strong>4.</strong> Read, share, or export the clean thread</p>
      </div>

      <div class="sidebar-panel">
        <h3>Top Threads</h3>
        <p style="color: var(--text-secondary); font-style: italic;">Recently read threads will appear here.</p>
      </div>
    </aside>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast"></div>

  <script>
    // ================================================================
    // State
    // ================================================================
    let currentThread = null;
    let currentSummary = null;
    let fontSize = 16;

    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => document.querySelectorAll(sel);

    // ================================================================
    // Init ‚Äî check URL params and path for tweet ID
    // ================================================================
    (function init() {
      // Check for /thread/:tweetId path
      const pathMatch = location.pathname.match(/\/thread\/(\d+)/);
      const urlParam = new URLSearchParams(location.search).get('url');

      if (pathMatch) {
        loadThreadById(pathMatch[1]);
      } else if (urlParam) {
        $('#thread-url').value = urlParam;
        handleSubmit();
      }
    })();

    // ================================================================
    // Form Handler
    // ================================================================
    $('#thread-form').addEventListener('submit', (e) => {
      e.preventDefault();
      handleSubmit();
    });

    async function handleSubmit() {
      const url = $('#thread-url').value.trim();
      if (!url) return;

      // Validate URL
      const tweetPattern = /(?:twitter\.com|x\.com)\/\w+\/status\/(\d+)/;
      const match = url.match(tweetPattern);
      if (!match) {
        showError('Please enter a valid Twitter/X thread URL (e.g., https://x.com/user/status/123456)');
        return;
      }

      hideError();
      showSkeleton();
      hideResult();

      try {
        // Unroll thread
        const res = await fetch('/api/thread/unroll', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ url }),
        });

        if (!res.ok) {
          const err = await res.json();
          throw new Error(err.message || err.error || 'Failed to unroll thread');
        }

        currentThread = await res.json();

        // Update URL for shareability
        const tweetId = match[1];
        history.pushState(null, '', `/thread/${tweetId}`);

        // Render thread
        renderThread(currentThread);

        // Fetch AI summary in parallel
        fetchSummary(currentThread);

        // Update SEO meta tags
        updateMeta(currentThread);

      } catch (error) {
        hideSkeleton();
        showError(error.message || 'Something went wrong. Please try again.');
      }
    }

    async function loadThreadById(tweetId) {
      showSkeleton();
      hideResult();

      try {
        const res = await fetch(`/api/thread/${tweetId}`);
        if (!res.ok) throw new Error('Thread not found');
        currentThread = await res.json();
        renderThread(currentThread);
        fetchSummary(currentThread);
        updateMeta(currentThread);
      } catch (error) {
        hideSkeleton();
        showError('Could not load thread. Try pasting the URL manually.');
      }
    }

    // ================================================================
    // Render Thread
    // ================================================================
    function renderThread(thread) {
      hideSkeleton();

      // Author header
      const avatar = $('#author-avatar');
      if (thread.author.avatar) {
        avatar.src = thread.author.avatar;
        avatar.alt = `${thread.author.name} avatar`;
      } else {
        avatar.src = `data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'><rect width='48' height='48' rx='24' fill='%23333'/><text x='24' y='30' text-anchor='middle' fill='white' font-size='20'>${(thread.author.name || '?')[0]}</text></svg>`;
      }
      $('#author-name').textContent = thread.author.name || thread.author.username;
      $('#author-username').textContent = `@${thread.author.username}`;

      const firstDate = thread.tweets[0]?.timestamp ? new Date(thread.tweets[0].timestamp).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) : '';
      $('#thread-meta').textContent = `${thread.threadLength} tweets${firstDate ? ' ¬∑ ' + firstDate : ''}`;

      // Tweets
      const container = $('#tweets-container');
      container.innerHTML = '';

      thread.tweets.forEach((tweet) => {
        const card = document.createElement('div');
        card.className = 'tweet-card';

        let mediaHtml = '';
        if (tweet.media && tweet.media.length > 0) {
          mediaHtml = tweet.media.map((m) => {
            if (m.type === 'video') {
              return `<div class="tweet-media"><video src="${escapeHtml(m.url)}" controls preload="metadata"></video></div>`;
            }
            return `<div class="tweet-media"><img src="${escapeHtml(m.url)}" alt="Tweet media" loading="lazy"></div>`;
          }).join('');
        }

        let statsHtml = '';
        if (tweet.stats) {
          const parts = [];
          if (tweet.stats.replies) parts.push(`<span class="tweet-stat">üí¨ ${formatNum(tweet.stats.replies)}</span>`);
          if (tweet.stats.retweets) parts.push(`<span class="tweet-stat">üîÅ ${formatNum(tweet.stats.retweets)}</span>`);
          if (tweet.stats.likes) parts.push(`<span class="tweet-stat">‚ù§Ô∏è ${formatNum(tweet.stats.likes)}</span>`);
          if (tweet.stats.views) parts.push(`<span class="tweet-stat">üëÅ ${formatNum(tweet.stats.views)}</span>`);
          if (parts.length) statsHtml = `<div class="tweet-stats">${parts.join('')}</div>`;
        }

        const timeHtml = tweet.timestamp ? `<div class="tweet-timestamp">${new Date(tweet.timestamp).toLocaleString()}</div>` : '';

        card.innerHTML = `
          <span class="tweet-number">${tweet.number}/${thread.threadLength}</span>
          <div class="tweet-text">${escapeHtml(tweet.text)}</div>
          ${mediaHtml}
          ${statsHtml}
          ${timeHtml}
        `;
        container.appendChild(card);
      });

      // Read on X link
      $('#read-on-x').href = thread.sourceUrl;

      // Show result
      $('#thread-result').classList.add('visible');

      // Scroll to thread
      $('#author-header').scrollIntoView({ behavior: 'smooth', block: 'start' });

      // SEO content
      $('#seo-content').textContent = thread.tweets.map(t => t.text).join('\n\n');
    }

    // ================================================================
    // AI Summary
    // ================================================================
    async function fetchSummary(thread) {
      // Show loading state
      const content = $('#ai-summary-content');
      content.innerHTML = '<p class="ai-unavailable">Generating AI summary...</p>';

      try {
        const res = await fetch('/api/thread/summarize', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ tweets: thread.tweets, author: thread.author?.username }),
        });

        if (!res.ok) throw new Error('Summary failed');
        currentSummary = await res.json();
        renderSummary(currentSummary);

        // Auto-open if summary is available
        if (currentSummary.available) {
          $('#ai-summary').classList.add('open');
          $('#ai-summary-toggle').setAttribute('aria-expanded', 'true');
        }
      } catch (e) {
        content.innerHTML = '<p class="ai-unavailable">AI summary unavailable for this thread.</p>';
      }
    }

    function renderSummary(summary) {
      const content = $('#ai-summary-content');

      if (!summary.available) {
        content.innerHTML = `<p class="ai-unavailable">${escapeHtml(summary.message || 'AI summary not available.')}</p>`;
        return;
      }

      let html = '';
      if (summary.summary) {
        html += `<p class="ai-summary-text">${escapeHtml(summary.summary)}</p>`;
      }
      if (summary.keyPoints && summary.keyPoints.length > 0) {
        html += '<ul class="ai-key-points">';
        summary.keyPoints.forEach((point) => {
          html += `<li>${escapeHtml(point)}</li>`;
        });
        html += '</ul>';
      }
      if (summary.readingTime) {
        html += `<p class="ai-reading-time">üìñ ${escapeHtml(summary.readingTime)} read</p>`;
      }

      content.innerHTML = html;
    }

    // Toggle AI summary
    $('#ai-summary-toggle').addEventListener('click', () => {
      const el = $('#ai-summary');
      el.classList.toggle('open');
      $('#ai-summary-toggle').setAttribute('aria-expanded', el.classList.contains('open'));
    });
    $('#ai-summary-toggle').addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        $('#ai-summary-toggle').click();
      }
    });

    // ================================================================
    // Actions
    // ================================================================

    // Copy as text
    $('#copy-text-btn').addEventListener('click', async () => {
      if (!currentThread) return;
      const text = threadToText(currentThread);
      await copyToClipboard(text);
      showToast('Copied as plain text!');
    });

    // Copy as markdown
    $('#copy-md-btn').addEventListener('click', async () => {
      if (!currentThread) return;
      const md = threadToMarkdown(currentThread);
      await copyToClipboard(md);
      showToast('Copied as markdown!');
    });

    // Save as PDF
    $('#save-pdf-btn').addEventListener('click', () => {
      window.print();
    });

    // Share
    $('#share-btn').addEventListener('click', async () => {
      const url = location.href;
      if (navigator.share) {
        try {
          await navigator.share({
            title: document.title,
            url,
          });
        } catch (e) {
          // User cancelled share
        }
      } else {
        await copyToClipboard(url);
        showToast('Link copied to clipboard!');
      }
    });

    // ================================================================
    // Theme Toggle
    // ================================================================
    const themeToggle = $('#theme-toggle');
    const savedTheme = localStorage.getItem('xactions-theme') || 'dark';
    if (savedTheme === 'light') {
      document.documentElement.setAttribute('data-theme', 'light');
      themeToggle.textContent = 'üåô';
    }

    themeToggle.addEventListener('click', () => {
      const isLight = document.documentElement.getAttribute('data-theme') === 'light';
      if (isLight) {
        document.documentElement.removeAttribute('data-theme');
        themeToggle.textContent = '‚òÄÔ∏è';
        localStorage.setItem('xactions-theme', 'dark');
      } else {
        document.documentElement.setAttribute('data-theme', 'light');
        themeToggle.textContent = 'üåô';
        localStorage.setItem('xactions-theme', 'light');
      }
    });

    // ================================================================
    // Font Size
    // ================================================================
    $('#font-up').addEventListener('click', () => {
      fontSize = Math.min(fontSize + 2, 24);
      document.body.style.setProperty('--font-size', fontSize + 'px');
      document.body.style.fontSize = fontSize + 'px';
    });
    $('#font-down').addEventListener('click', () => {
      fontSize = Math.max(fontSize - 2, 12);
      document.body.style.setProperty('--font-size', fontSize + 'px');
      document.body.style.fontSize = fontSize + 'px';
    });

    // ================================================================
    // Helpers
    // ================================================================
    function showSkeleton() { $('#skeleton').classList.add('visible'); }
    function hideSkeleton() { $('#skeleton').classList.remove('visible'); }
    function showResult() { $('#thread-result').classList.add('visible'); }
    function hideResult() { $('#thread-result').classList.remove('visible'); }
    function showError(msg) { const el = $('#input-error'); el.textContent = msg; el.classList.add('visible'); }
    function hideError() { $('#input-error').classList.remove('visible'); }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text || '';
      return div.innerHTML;
    }

    function formatNum(n) {
      if (!n) return '0';
      if (n >= 1000000) return (n / 1000000).toFixed(1) + 'M';
      if (n >= 1000) return (n / 1000).toFixed(1) + 'K';
      return n.toString();
    }

    function threadToText(thread) {
      let out = `Thread by @${thread.author.username}\n${'='.repeat(50)}\n\n`;
      thread.tweets.forEach((t) => {
        out += `[${t.number}/${thread.threadLength}]\n${t.text}\n\n`;
      });
      out += `\nOriginal: ${thread.sourceUrl}\n`;
      return out;
    }

    function threadToMarkdown(thread) {
      let out = `# Thread by @${thread.author.username}\n\n`;
      out += `> ${thread.threadLength} tweets\n\n---\n\n`;
      thread.tweets.forEach((t) => {
        out += `**${t.number}/${thread.threadLength}**\n\n${t.text}\n\n`;
        if (t.media) {
          t.media.forEach((m) => {
            out += m.type === 'image' ? `![Image](${m.url})\n\n` : `üé• [Video](${m.url})\n\n`;
          });
        }
        out += `---\n\n`;
      });
      out += `\n[Original Thread](${thread.sourceUrl})\n`;
      return out;
    }

    async function copyToClipboard(text) {
      try {
        await navigator.clipboard.writeText(text);
      } catch (e) {
        // Fallback
        const ta = document.createElement('textarea');
        ta.value = text;
        ta.style.cssText = 'position:fixed;top:-9999px';
        document.body.appendChild(ta);
        ta.select();
        document.execCommand('copy');
        document.body.removeChild(ta);
      }
    }

    function showToast(msg) {
      const toast = $('#toast');
      toast.textContent = msg;
      toast.classList.add('visible');
      setTimeout(() => toast.classList.remove('visible'), 2500);
    }

    function updateMeta(thread) {
      const preview = (thread.tweets[0]?.text || '').slice(0, 100);
      const title = `Thread by @${thread.author.username}: ${preview} | XActions Thread Reader`;

      document.title = title;
      const setContent = (id, val) => { const el = document.getElementById(id); if (el) el.setAttribute('content', val); };
      setContent('page-description', `Thread by @${thread.author.username} ‚Äî ${thread.threadLength} tweets. ${preview}`);
      setContent('og-title', title);
      setContent('og-description', preview);
      setContent('og-url', location.href);
      setContent('tw-title', title);
      setContent('tw-description', preview);
      const canon = document.getElementById('canonical-link');
      if (canon) canon.setAttribute('href', location.href);
    }
  </script>
</body>
</html>
